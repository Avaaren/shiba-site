{% extends 'pictures/base.html' %}
{% load static %}

{% block title %}Get shiba image {% endblock %}

{% block content %}

<div class="wrapper">
    <div class="header">
        Любишь шайб, но в твоей галерее их слишком мало?

        Воспользуйся нашим сервисом и получи доступ к неисчерпаемому источнику милых собачек

        Найди свою прямо сейчас
    </div>
    <div class="image-container">
        <div class="image">
            <img src="{{ image_url }}" alt="">
        </div>
    </div>
    <div class="buttons">
        <form action="." method="get">
            <button type="submit">Новая шайбочка</button>
        </form>
        <button id='download'>Скачать</button>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

<script>
    $(document).ready(function () {
        let image_url = '{{ image_url }}';
        let filename = '{{ filename }}';



        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = cookies[i].trim();
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        $('#download').on('click', function () {
            console.log('sadsadasdas');
            $.ajax({
                url: 'download/',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'),
                },
                method: 'POST',
                data: {
                    'filename': filename,
                    'image_url': image_url,
                    // csrfmiddlewaretoken: getCookie('csrftoken')
                },
                dataType: 'json',
                success: function (response) {
                    console.log(response);
                }
            });
        });
    });
</script>
{% endblock %}